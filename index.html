<!DOCTYPE html>
<meta charset="utf-8" />
<link rel="manifest" href="manifest.json" />
<link rel="stylesheet" href="assets/style.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="application-name" content="MarcosPay" />
<title>marcospay.com - A Basic Card implementation</title>
<main>
  <h1>ðŸ’¸ Welcome to Marcos Pay ðŸ’¸</h1>
</main>
<aside id="update-toast">
  <p>
    Site has been updated!
    <button id="refresh">refresh?</button>
    <button id="dismiss">No thanks!</button>
  </p>
</aside>

<script>
  window.onload = async () => {
    const reg = await navigator.serviceWorker.register("sw.js");

    if (!navigator.serviceWorker.controller) {
      return;
    }

    if (reg.installing) {
      trackInstallation(reg.installing);
      return;
    }

    if (reg.waiting) {
      updateReady(reg.waiting);
      return;
    }

    reg.addEventListener("updatefound", () => {
      trackInstallation(reg.installing);
    });

    navigator.serviceWorker.addEventListener("controllerchange", () => {
      window.location.reload();
    });

    function trackInstallation(sw) {
      sw.addEventListener("statechange", () => {
        switch (sw.state) {
          case "installed":
            updateReady(sw);
            break;
        }
      });
    }

    function updateReady(sw) {
      console.info("Update ready");
      const toast = document.querySelector("#update-toast");
      const refresh = document.querySelector("#refresh");
      const dismiss = document.querySelector("#dismiss");
      toast.classList.add("show");
      dismiss.onclick = () => toast.classList.remove("show");
      refresh.onclick = () => {
        toast.classList.remove("show");
        // Let SW know it can take over
        sw.postMessage({
          action: "skipWaiting",
        });
      };
    }
  };
</script>
